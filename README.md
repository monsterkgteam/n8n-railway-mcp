# 🤖 N8N Telegram Bot - Интеллектуальный Агентский Помощник

Многофункциональный Telegram-бот с агентской архитектурой для управления библиотекой n8n шаблонов. Бот обладает возможностями голосового взаимодействия, долгосрочной памятью, системой мышления и автономного управления сервером n8n.

## 🌟 Основные возможности

### 🧠 Агентская архитектура
- **Оркестратор агентов** - координирует работу специализированных агентов
- **Агент шаблонов** - поиск, анализ и рекомендации шаблонов n8n
- **Серверный агент** - управление workflows, импорт/экспорт, мониторинг
- **Агент-координатор** - планирование и оптимизация задач
- **Агент мониторинга** - отслеживание состояния системы

### 🎤 Голосовые возможности
- Распознавание речи с помощью OpenAI Whisper
- Синтез речи для ответов бота
- Поддержка русского и английского языков
- Автоматическая конвертация аудио форматов

### 🧠 Система мышления
- **Аналитическое мышление** - глубокий анализ ситуаций
- **Планирование** - создание детальных планов действий
- **Рефлексия** - анализ прошлых действий и обучение
- **Коллективное мышление** - совместная работа агентов
- **Метакогнитивные процессы** - мышление о мышлении

### 💾 Система памяти
- **Краткосрочная память** - контекст текущей сессии
- **Долгосрочная память** - предпочтения и настройки пользователя
- **История разговоров** - полная история взаимодействий
- **Контекстная память** - понимание контекста запросов

### 🔧 Управление n8n
- Автоматический импорт шаблонов в n8n
- Активация/деактивация workflows
- Мониторинг выполнения workflows
- Экспорт workflows в JSON
- Управление учетными данными

### 📚 Библиотека шаблонов
- База данных 500+ шаблонов n8n
- Категоризация по типам задач
- Интеллектуальный поиск и рекомендации
- Анализ сложности и популярности
- Автоматическое обновление базы

## 🚀 Быстрый старт

### Предварительные требования
- Python 3.11+
- Telegram Bot Token
- OpenAI API Key
- n8n сервер (опционально)
- Redis (опционально, для расширенной памяти)

### Установка

1. **Клонирование репозитория**
```bash
git clone https://github.com/yourusername/n8n-telegram-bot.git
cd n8n-telegram-bot
```

2. **Создание виртуального окружения**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. **Установка зависимостей**
```bash
pip install -r requirements.txt
```

4. **Настройка переменных окружения**
```bash
cp .env.example .env
# Отредактируйте .env файл с вашими ключами
```

5. **Инициализация базы данных**
```bash
python -c "from src.models.template import init_db; init_db()"
```

6. **Запуск бота**
```bash
python src/main.py
```

## ⚙️ Конфигурация

### Переменные окружения (.env)

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token

# OpenAI
OPENAI_API_KEY=your_openai_api_key

# n8n (опционально)
N8N_BASE_URL=http://localhost:5678
N8N_API_KEY=your_n8n_api_key

# Redis (опционально)
REDIS_URL=redis://localhost:6379/0

# База данных
DATABASE_URL=sqlite:///n8n_bot.db

# Логирование
LOG_LEVEL=INFO
LOG_FILE=bot.log

# Голосовые возможности
VOICE_ENABLED=true
VOICE_LANGUAGE=ru

# Система мышления
THINKING_ENABLED=true
REFLECTION_ENABLED=true
```

## 📖 Использование

### Основные команды

- `/start` - Запуск бота и приветствие
- `/help` - Справка по командам
- `/search [запрос]` - Поиск шаблонов
- `/categories` - Просмотр категорий
- `/import [название]` - Импорт шаблона
- `/workflows` - Список ваших workflows
- `/status` - Статус системы агентов
- `/thinking [агент]` - Мысли агентов
- `/remind [минуты] [сообщение]` - Установка напоминания

### Естественный язык

Бот понимает естественные запросы на русском и английском языках:

```
"Найди шаблоны для email автоматизации"
"Импортируй шаблон AI Email Response"
"Активируй workflow с ID 123"
"Покажи статистику по категориям"
"Настрой мой API ключ n8n"
```

### Голосовые команды

Отправьте голосовое сообщение боту, и он:
1. Распознает речь
2. Обработает запрос
3. Выполнит действие
4. Ответит текстом и голосом (опционально)

## 🏗️ Архитектура

### Компоненты системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Telegram Bot   │    │ Agent           │    │ Voice Service   │
│                 │◄──►│ Orchestrator    │◄──►│                 │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ Template        │    │ Thinking        │    │ Memory          │
│ Service         │    │ Service         │    │ Service         │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ N8N API         │    │ OpenAI API      │    │ Database        │
│ Client          │    │                 │    │ (SQLite/Redis)  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### Агенты

1. **TemplateAgent** - Специалист по шаблонам
   - Поиск и анализ шаблонов
   - Рекомендации на основе предпочтений
   - Категоризация и статистика

2. **ServerAgent** - Менеджер сервера n8n
   - Импорт/экспорт workflows
   - Управление состоянием workflows
   - Мониторинг выполнения

3. **CoordinatorAgent** - Координатор задач
   - Планирование выполнения
   - Разрешение конфликтов
   - Оптимизация ресурсов

4. **MonitorAgent** - Системный монитор
   - Отслеживание производительности
   - Обнаружение ошибок
   - Генерация отчетов

## 🧪 Тестирование

### Запуск тестов

```bash
# Все тесты
pytest

# Конкретный модуль
pytest tests/test_agent_orchestrator.py

# С покрытием
pytest --cov=src tests/

# Подробный вывод
pytest -v tests/
```

### Структура тестов

```
tests/
├── test_agent_orchestrator.py  # Тесты оркестратора
├── test_voice_service.py       # Тесты голосовых сервисов
├── test_template_service.py    # Тесты работы с шаблонами
├── test_thinking_service.py    # Тесты системы мышления
└── test_integration.py         # Интеграционные тесты
```

## 📊 Мониторинг и логирование

### Логи

Бот ведет подробные логи всех операций:

```
logs/
├── bot.log              # Основные логи бота
├── agents.log           # Логи работы агентов
├── thinking.log         # Логи системы мышления
└── errors.log           # Логи ошибок
```

### Метрики

- Количество обработанных запросов
- Время отклика агентов
- Успешность выполнения задач
- Использование памяти и ресурсов

## 🔧 Разработка

### Структура проекта

```
n8n-telegram-bot/
├── src/
│   ├── models/          # Модели данных
│   ├── services/        # Бизнес-логика
│   ├── routes/          # API маршруты
│   ├── static/          # Статические файлы
│   ├── telegram_bot.py  # Основной бот
│   └── main.py          # Точка входа
├── tests/               # Тесты
├── docs/                # Документация
├── logs/                # Логи
├── data/                # Данные шаблонов
├── requirements.txt     # Зависимости
├── .env.example         # Пример конфигурации
└── README.md           # Документация
```

### Добавление нового агента

1. Создайте класс агента, наследующий от `Agent`
2. Реализуйте метод `execute_task`
3. Добавьте агента в `AgentOrchestrator`
4. Обновите маппинг задач в `orchestrate_agents`

```python
class CustomAgent(Agent):
    def __init__(self, thinking_service, memory_service):
        super().__init__("CustomAgent", AgentRole.CUSTOM, thinking_service, memory_service)
        self.capabilities = {'custom_task'}
    
    async def execute_task(self, task: Dict[str, Any]) -> Dict[str, Any]:
        # Ваша логика
        return {'success': True, 'result': 'Custom task completed'}
```

## 🤝 Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## 📝 Лицензия

Этот проект лицензирован под MIT License - см. файл [LICENSE](LICENSE) для деталей.

## 🙏 Благодарности

- [n8n](https://n8n.io/) - за отличную платформу автоматизации
- [OpenAI](https://openai.com/) - за API для голоса и мышления
- [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) - за библиотеку Telegram

## 📞 Поддержка

- 📧 Email: support@example.com
- 💬 Telegram: @your_support_bot
- 🐛 Issues: [GitHub Issues](https://github.com/yourusername/n8n-telegram-bot/issues)

## 🗺️ Roadmap

- [ ] Веб-интерфейс для управления
- [ ] Интеграция с другими платформами автоматизации
- [ ] Машинное обучение для улучшения рекомендаций
- [ ] Мультиязычная поддержка
- [ ] Расширенная аналитика и отчеты
- [ ] Интеграция с облачными сервисами

---

**Создано с ❤️ для сообщества n8n**
